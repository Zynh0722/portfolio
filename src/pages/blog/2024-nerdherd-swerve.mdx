---
layout: "@layouts/BlogPost.astro"
title: 2024 NerdHerd Swerve Overview
description: A brief overview of the swerve code that FRC 4043 NerdHerd
  used for swerve through the 2024 season
categories: [frc, robotics, swerve]
author: Zynh Ludwig
draft: true
---

## TODO

- footnotes for heading correction and cosine compensation?
- Figure out impact of wpilib 2025

## Preface

[YAGSL]: https://docs.yagsl.com
[CTRE's swerve framework]: https://v6.docs.ctr-electronics.com/en/stable/docs/api-reference/mechanisms/swerve/swerve-overview.html
[heading correction]: https://docs.yagsl.com/overview/our-features/heading-correction
[cosine compensation]: https://docs.yagsl.com/overview/our-features/cosine-compensation

The current NerdHerd swerve code's core functionality is all put together
by hand, using WPILib utils whenever possible to offload work. As such it also
doesn't do anything fancy that you might get with using [CTRE's swerve
framework] or [YAGSL], such as [heading correction] or [cosine compensation].
It also doesn't do some simple things, like a lock pose. This doesn't mean
those things are impossible, the code is simple enough
that any of those features could be added.

This code largely acts as a minimum barrier to entry in to swerve for teams
who are interested in implementing things largely for themselves. If you just
want something that works good with minimal effort, go use one of the previous
linked frameworks. They will likely be easier to setup, and give you a better
end result.

Also we program in Java. My apologies.

## What problem are we trying to solve?

[team 1640's definition]: https://team1640.com/wiki/index.php/Swerve_Central
[DifferentialDrive]: https://github.wpilib.org/allwpilib/docs/release/java/edu/wpi/first/wpilibj/drive/DifferentialDrive.html
[arcadeDrive]: https://github.wpilib.org/allwpilib/docs/release/java/edu/wpi/first/wpilibj/drive/DifferentialDrive.html#arcadeDrive(double,double)
[tankDrive]: https://github.wpilib.org/allwpilib/docs/release/java/edu/wpi/first/wpilibj/drive/DifferentialDrive.html#tankDrive(double,double)

Outside of FRC the defintion of swerve drive is a bit more broad, but for the
purposes of FRC, I quite like [team 1640's definition], where a swerve drive is
any drive train where **all drive wheels are independently driven and steered**.

And to everyone's surpise, our team wanted to control our robot with some kind
of joystick? and they expect it to move?

If we were making a skid steer platform, we could just use [DifferentialDrive]
and be done with it. Directly pipe our controller inputs into the diffdrive's
[tankDrive] or [arcadeDrive] methods, and we'd have a driving robot.

Unfortunately with a swerve drive we can't simply map out inputs to our outputs,
as in all but the simplest case,

We'll pin the joystick thing until later and for now we will simply work on
getting the robot to move without a joystick.[^1]

### The components of swerve drive control

#### Kinematics

#### Module Control

Once we know what speed and direction the modules need to go, we need to
actually control the motors

### The problems we can lean on WPILib for

#### WPILib Kinematics

Thankfully WPILib almost entirely removes the kinematics problem for us. The
`SwerveDriveKinematics` class.

#### PID Loops

Our implementation uses PID loops for controlling our module positions. I
honestly don't know of anyone who _doesn't_ use a PID loop for module heading
control, and most use them for module speed control.[^1]

[^1]: Testing?
